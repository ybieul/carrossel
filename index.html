<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NicheCarousel Pro - Multi-Indústria</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Export Libs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Lato:wght@400;700&family=Montserrat:wght@700;800&family=Open+Sans:wght@400;600&family=Oswald:wght@700&family=Outfit:wght@300;500;700;900&family=Playfair+Display:wght@700;900&family=Roboto:wght@400;500&family=Space+Grotesk:wght@700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0c0a09; }
        ::-webkit-scrollbar-thumb { background: #44403c; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d97706; }

        .hyphens-auto { hyphens: auto; }
    </style>
</head>
<body class="bg-stone-950 text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ÍCONES SVG (Substituição da Lucide para evitar erros de React.createElement) ---
        const IconBase = ({ children, size = 24, className = "", ...props }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className} 
                {...props}
            >
                {children}
            </svg>
        );

        const Icons = {
            Scissors: (props) => <IconBase {...props}><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></IconBase>,
            Tractor: (props) => <IconBase {...props}><path d="M3 4h9l1 7"/><path d="M4 11V4"/><path d="M8 10V4"/><path d="M18 5c-.6 0-1 .4-1 1v5.6"/><path d="M15 17a2 2 0 1 0 4 0 2 2 0 0 0-4 0Z"/><path d="M8 17a2 2 0 1 0 4 0 2 2 0 0 0-4 0Z"/><path d="M18 13.1a5.7 5.7 0 0 1 1.9.9l.6-1-1.1-.6"/><path d="M22 15a5.7 5.7 0 0 1-2 2l-.6-1 1.1-.6"/><path d="M13 11h9l-1.9 3H13v-3Z"/><path d="M5 17H2v-3h3"/></IconBase>,
            Layout: (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></IconBase>,
            Maximize: (props) => <IconBase {...props}><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></IconBase>,
            SplitSquareVertical: (props) => <IconBase {...props}><path d="M5 8V5c0-1 1-2 2-2h10c1 0 2 1 2 2v3"/><path d="M19 16v3c0 1-1 2-2 2H7c-1 0-2-1-2-2v-3"/><line x1="4" x2="20" y1="12" y2="12"/></IconBase>,
            AlignLeft: (props) => <IconBase {...props}><line x1="21" x2="3" y1="6" y2="6"/><line x1="15" x2="3" y1="12" y2="12"/><line x1="17" x2="3" y1="18" y2="18"/></IconBase>,
            ListOrdered: (props) => <IconBase {...props}><line x1="10" x2="21" y1="6" y2="6"/><line x1="10" x2="21" y1="12" y2="12"/><line x1="10" x2="21" y1="18" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></IconBase>,
            Quote: (props) => <IconBase {...props}><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z"/></IconBase>,
            Monitor: (props) => <IconBase {...props}><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></IconBase>,
            Grid: (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></IconBase>,
            FileText: (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>,
            RefreshCw: (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>,
            ImageIcon: (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></IconBase>,
            Palette: (props) => <IconBase {...props}><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></IconBase>,
            Type: (props) => <IconBase {...props}><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></IconBase>,
            Layers: (props) => <IconBase {...props}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z"/><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65"/><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65"/></IconBase>,
            User: (props) => <IconBase {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconBase>,
            Sparkles: (props) => <IconBase {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 9h4"/></IconBase>,
            ChevronRight: (props) => <IconBase {...props}><path d="m9 18 6-6-6-6"/></IconBase>,
            ChevronLeft: (props) => <IconBase {...props}><path d="m15 18-6-6 6-6"/></IconBase>,
            Trash2: (props) => <IconBase {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></IconBase>,
            Plus: (props) => <IconBase {...props}><path d="M5 12h14"/><path d="M12 5v14"/></IconBase>,
            ArrowRight: (props) => <IconBase {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>,
            Instagram: (props) => <IconBase {...props}><rect width="20" height="20" x="2" y="2" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" x2="17.51" y1="6.5" y2="6.5"/></IconBase>,
            Linkedin: (props) => <IconBase {...props}><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect width="4" height="12" x="2" y="9"/><circle cx="4" cy="4" r="2"/></IconBase>
        };

        // Destructuring icons for easy usage
        const { Scissors, Tractor, Layout, Maximize, SplitSquareVertical, AlignLeft, ListOrdered, Quote, Monitor, Grid, FileText, RefreshCw, ImageIcon, Palette, Type, Layers, User, Sparkles, ChevronRight, ChevronLeft, Trash2, Plus, ArrowRight, Instagram, Linkedin } = Icons;

        const apiKey = ""; // Insira sua API Key

        // --- CONFIGURAÇÃO DE NICHOS (O CÉREBRO DO SISTEMA) ---
        const NICHES = {
            barber: {
                id: 'barber',
                label: 'Barbearia & Style',
                icon: <Scissors size={18} />,
                color: 'text-amber-500',
                bgColor: 'bg-amber-600',
                borderColor: 'border-amber-600',
                promptRole: "Atue como Barbeiro Profissional e Especialista em Estilo Masculino.",
                defaultTheme: { 
                    primary: '#D4AF37', // Gold
                    secondary: '#FFFFFF', 
                    background: '#1c1917', // Stone 900
                    text: '#e7e5e4', // Stone 200
                    accent: '#ef4444' // Red
                },
                defaultProfile: { name: '@BarberKing', handle: 'Cortes Clássicos', show: true },
                imageStyles: {
                    vintage: { name: "Vintage / Old School", prompt: "vintage barbershop interior, leather chairs, classic tools, warm retro lighting, 1950s aesthetic" },
                    modern: { name: "Modern Studio", prompt: "modern minimalist hair studio, bright clinical lighting, sharp focus, professional barber tools" },
                    dark_luxury: { name: "Dark Luxury", prompt: "luxury barbershop, dark moody lighting, gold accents, black marble, cinematic, masculine aesthetic" },
                    macro_hair: { name: "Detalhe (Macro)", prompt: "extreme close up of a haircut fade, sharp lines, hair texture, professional photography" },
                    neon: { name: "Neon Street", prompt: "barbershop window at night, neon barber pole, rainy street, cinematic, cyberpunk vibes" }
                },
                defaultSlides: [
                    { id: 1, type: 'cover', title: "Estilo & Corte", subtitle: "Tendências 2025", imageKeyword: "haircut fade", content: "O guia definitivo para o homem moderno." },
                    { id: 2, type: 'content', title: "Textura", content: "Aposte em finalizadores mate para um visual natural e duradouro.", imageKeyword: "hair product" },
                    { id: 3, type: 'content', title: "Navalhado", content: "O acabamento na navalha traz definição e um visual mais limpo.", imageKeyword: "straight razor" },
                    { id: 4, type: 'cta', title: "Reserve Já", content: "Agenda aberta para esta semana. Link na bio.", imageKeyword: "barber chair" }
                ]
            },
            agro: {
                id: 'agro',
                label: 'Agro & Pecuária',
                icon: <Tractor size={18} />,
                color: 'text-emerald-500',
                bgColor: 'bg-emerald-600',
                borderColor: 'border-emerald-600',
                promptRole: "Atue como Engenheiro Agrônomo e Especialista em Pecuária de Precisão. Use termos técnicos do setor.",
                defaultTheme: { 
                    primary: '#059669', // Emerald 600
                    secondary: '#1c1917', // Dark text for contrast on light bg
                    background: '#f5f5f4', // Stone 100 (Light)
                    text: '#292524', // Stone 800
                    accent: '#d97706' // Amber (Trigo/Sol)
                },
                defaultProfile: { name: '@AgroTech', handle: 'Soluções Rurais', show: true },
                imageStyles: {
                    field_realistic: { name: "Campo Realista", prompt: "wide angle shot of a green pasture, blue sky, sunny day, high resolution, national geographic style" },
                    drone: { name: "Vista Aérea (Drone)", prompt: "aerial drone shot of farmland, geometric crop patterns, cinematic lighting, 4k" },
                    cattle_portrait: { name: "Retrato Animal", prompt: "close up portrait of a prize bull, detailed fur, soft natural lighting, blurred background, professional photography" },
                    tech_agro: { name: "Agro Tech", prompt: "futuristic smart farm, drones spraying crops, digital data overlay, interface, technology in agriculture" },
                    sunset: { name: "Pôr do Sol Rural", prompt: "golden hour over a wheat field, warm lighting, silhouette of a tractor, emotional, cinematic" }
                },
                defaultSlides: [
                    { id: 1, type: 'cover', title: "Manejo Eficiente", subtitle: "Lucratividade no Pasto", imageKeyword: "cattle grazing", content: "Como aumentar a arroba sem aumentar o custo." },
                    { id: 2, type: 'content', title: "Nutrição", content: "O sal mineral é o investimento de menor custo e maior retorno na seca.", imageKeyword: "cattle eating" },
                    { id: 3, type: 'content', title: "Genética", content: "Touros melhoradores garantem bezerros mais pesados na desmama.", imageKeyword: "bull prize" },
                    { id: 4, type: 'cta', title: "Saiba Mais", content: "Baixe nosso e-book gratuito sobre pastagem rotacionada.", imageKeyword: "farm tablet" }
                ]
            }
        };

        const LAYOUT_STYLES = {
            classic: { id: 'classic', name: 'Clássico', icon: <Layout size={16} />, description: 'Imagem topo, texto base' },
            immersive: { id: 'immersive', name: 'Imersivo', icon: <Maximize size={16} />, description: 'Fundo completo' },
            editorial: { id: 'editorial', name: 'Editorial', icon: <SplitSquareVertical size={16} />, description: 'Divisão 50/50' },
            minimal: { id: 'minimal', name: 'Minimalista', icon: <AlignLeft size={16} />, description: 'Foco em tipografia' },
            listicle: { id: 'listicle', name: 'Lista (Num)', icon: <ListOrdered size={16} />, description: 'Números gigantes' },
            quote: { id: 'quote', name: 'Citação', icon: <Quote size={16} />, description: 'Frase centralizada' }
        };

        const FONT_PAIRS = {
            modern: { name: "Moderno", title: "Montserrat", body: "Open Sans" },
            elegant: { name: "Elegante", title: "Playfair Display", body: "Lato" },
            bold: { name: "Impacto", title: "Oswald", body: "Roboto" },
            tech: { name: "Tech", title: "Space Grotesk", body: "Inter" },
            lufga: { name: "Lufga (Geo)", title: "Outfit", body: "Outfit" }
        };

        const FORMATS = {
            instagram: { name: "Instagram (4:5)", width: 1080, height: 1350, icon: <Instagram size={16}/> },
            linkedin: { name: "LinkedIn (1:1)", width: 1080, height: 1080, icon: <Linkedin size={16}/> },
            presentation: { name: "Paisagem (16:9)", width: 1920, height: 1080, icon: <Monitor size={16}/> }
        };

        // --- HELPERS ---
        const getResponsiveFontSize = (text, type, canvasWidth, userScale = 1) => {
            const length = text ? text.length : 0;
            const baseScale = canvasWidth / 1080; 
            let size = 1;
            
            if (type === 'title') {
                if (length < 20) size = 5;
                else if (length < 40) size = 4;
                else if (length < 80) size = 3;
                else size = 2.2;
            } else if (type === 'body') {
                if (length < 100) size = 2;
                else if (length < 200) size = 1.6;
                else size = 1.4;
            } else if (type === 'subtitle') {
                size = 1.5;
            } else if (type === 'number') {
                size = 15;
            }

            return `${size * baseScale * userScale}rem`;
        };

        async function fetchWithRetry(url, options, retries = 3, backoff = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`Erro ${response.status}`);
                return response.json();
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, backoff));
                    return fetchWithRetry(url, options, retries - 1, backoff * 2);
                }
                throw error;
            }
        }

        // --- APP COMPONENT ---
        const App = () => {
            // --- STATES ---
            const [activeNiche, setActiveNiche] = useState('barber'); // 'barber' | 'agro'
            
            // Carregar dados baseados no nicho
            const currentNicheData = NICHES[activeNiche];

            const [slides, setSlides] = useState(currentNicheData.defaultSlides);
            const [theme, setTheme] = useState(currentNicheData.defaultTheme);
            const [profile, setProfile] = useState(currentNicheData.defaultProfile);
            const [activeImageStyle, setActiveImageStyle] = useState(Object.keys(currentNicheData.imageStyles)[0]);

            const [activeSlideIndex, setActiveSlideIndex] = useState(0);
            const [viewMode, setViewMode] = useState('edit');
            const [activeTab, setActiveTab] = useState('design');
            const [topic, setTopic] = useState('');
            const [isGenerating, setIsGenerating] = useState(false);
            const [isExporting, setIsExporting] = useState(false);
            const [dragedIndex, setDragedIndex] = useState(null);

            // Configurações Globais
            const [activeFormat, setActiveFormat] = useState('instagram');
            const [activeFontPair, setActiveFontPair] = useState('bold');
            const [activeLayout, setActiveLayout] = useState('classic');
            const [fontScales, setFontScales] = useState({ title: 1, subtitle: 1, body: 1 });

            // --- TROCA DE NICHO ---
            const handleNicheChange = (nicheId) => {
                if (nicheId === activeNiche) return;
                const newData = NICHES[nicheId];
                setActiveNiche(nicheId);
                setTheme(newData.defaultTheme);
                setSlides(newData.defaultSlides);
                setProfile(newData.defaultProfile);
                setActiveImageStyle(Object.keys(newData.imageStyles)[0]);
                setActiveSlideIndex(0);
            };

            // --- FUNÇÕES ---
            const addSlide = () => {
                const newSlide = {
                    id: Date.now(),
                    type: 'content',
                    title: 'Novo Tópico',
                    subtitle: '',
                    content: 'Insira seu conteúdo aqui.',
                    imageKeyword: activeNiche === 'agro' ? 'farm' : 'barbershop'
                };
                setSlides([...slides, newSlide]);
                setActiveSlideIndex(slides.length);
            };

            const removeSlide = (index) => {
                if (slides.length <= 1) return;
                const newSlides = slides.filter((_, i) => i !== index);
                setSlides(newSlides);
                if (activeSlideIndex >= newSlides.length) setActiveSlideIndex(newSlides.length - 1);
            };

            const generateCarousel = async () => {
                if (!topic) return;
                setIsGenerating(true);
                
                // Prompt Dinâmico Baseado no Nicho
                const prompt = `
                  ${currentNicheData.promptRole}
                  Crie um carrossel Instagram educativo sobre: "${topic}".
                  Gere 5 slides.
                  JSON Array: [{ "type": "cover"|"content"|"cta", "title": "string (curto)", "subtitle": "string", "content": "string (max 20 palavras)", "imageKeyword": "english keyword related to topic" }]
                `;
                
                if (!apiKey) {
                    setTimeout(() => {
                        // Simulação de resposta para o novo nicho Agro
                        if(activeNiche === 'agro'){
                             setSlides([
                                { id: 1, type: 'cover', title: topic || "Tecnologia no Campo", subtitle: "Agricultura 4.0", imageKeyword: "smart farming", content: "O futuro da produtividade rural." },
                                { id: 2, type: 'content', title: "Drones", content: "Monitoramento aéreo detecta pragas antes que se espalhem.", imageKeyword: "agriculture drone" },
                                { id: 3, type: 'content', title: "GPS Agrícola", content: "Precisão no plantio economiza sementes e combustível.", imageKeyword: "tractor gps" },
                                { id: 4, type: 'cta', title: "Modernize", content: "Conheça nossas soluções tecnológicas.", imageKeyword: "digital farm" }
                            ]);
                        } else {
                             setSlides([
                                { id: 1, type: 'cover', title: topic || "Corte Clássico", subtitle: "Elegância Atemporal", imageKeyword: "classic haircut", content: "Descubra por que os clássicos nunca morrem." },
                                { id: 2, type: 'content', title: "A Tesoura", content: "O corte na tesoura proporciona um caimento mais natural.", imageKeyword: "scissors hair" },
                                { id: 3, type: 'content', title: "Pomada ou Gel?", content: "Use pomada para efeito seco e gel para efeito molhado.", imageKeyword: "hair pomade" },
                                { id: 4, type: 'cta', title: "Agende", content: "Garanta seu horário hoje mesmo.", imageKeyword: "barber pole" }
                            ]);
                        }
                        setActiveSlideIndex(0);
                        setIsGenerating(false);
                    }, 1000);
                    return;
                }

                try {
                    const result = await fetchWithRetry(
                        `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                        { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }
                    );
                    let text = result.candidates?.[0]?.content?.parts?.[0]?.text.replace(/```json|```/g, '').trim();
                    setSlides(JSON.parse(text).map((s, i) => ({ ...s, id: Date.now() + i })));
                    setActiveSlideIndex(0); setViewMode('edit');
                } catch (e) { alert("Erro ao gerar."); } finally { setIsGenerating(false); }
            };

            const handleExport = async (type) => {
                if (typeof window.html2canvas === 'undefined') return;
                setIsExporting(true);
                const { jsPDF } = window.jspdf;
                const fmt = FORMATS[activeFormat];
                const pdf = new jsPDF({ orientation: fmt.width > fmt.height ? 'l' : 'p', unit: 'px', format: [fmt.width, fmt.height] });
                const originalViewMode = viewMode; 
                setViewMode('edit'); 
                
                try {
                    const hiddenDiv = document.createElement('div'); hiddenDiv.style.cssText = "position:fixed;top:-10000px;left:-10000px;"; document.body.appendChild(hiddenDiv);
                    for (let i = 0; i < slides.length; i++) {
                        setActiveSlideIndex(i); await new Promise(r => setTimeout(r, 600));
                        const canvas = await window.html2canvas(document.getElementById('slide-preview-area'), { scale: 2, useCORS: true, allowTaint: true, backgroundColor: theme.background });
                        const imgData = canvas.toDataURL('image/png');
                        if (type === 'pdf') { if (i > 0) pdf.addPage(); pdf.addImage(imgData, 'PNG', 0, 0, fmt.width, fmt.height); }
                    }
                    if (type === 'pdf') pdf.save(`${activeNiche}-carousel.pdf`);
                    document.body.removeChild(hiddenDiv);
                } catch (e) { console.error(e); alert("Erro na exportação."); } 
                finally { setIsExporting(false); setViewMode(originalViewMode); }
            };

            const handleAvatarUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => setProfile({ ...profile, avatar: reader.result });
                    reader.readAsDataURL(file);
                }
            };
            
            const handleDrag = (e, idx, type) => {
                if (type === 'start') { setDragedIndex(idx); e.dataTransfer.effectAllowed = "move"; }
                if (type === 'over') { e.preventDefault(); if (dragedIndex === null || dragedIndex === idx) return; const ns = [...slides]; const item = ns[dragedIndex]; ns.splice(dragedIndex, 1); ns.splice(idx, 0, item); setSlides(ns); setDragedIndex(idx); }
                if (type === 'end') setDragedIndex(null);
            };

            // --- COMPONENTS ---
            const ProfileBadge = ({ mode = 'dark' }) => {
                const isLightTheme = activeNiche === 'agro'; 
                const textColor = mode === 'light' 
                    ? 'text-white' 
                    : (isLightTheme ? 'text-stone-800' : 'text-stone-200');

                return (
                    <div className={`flex items-center gap-3 ${textColor} ${!profile.show ? 'opacity-0' : 'opacity-100'}`}>
                        <div className={`w-10 h-10 rounded-full overflow-hidden border-2 border-current/20 shadow-md flex-shrink-0 ${isLightTheme ? 'bg-white' : 'bg-stone-800'}`}>
                            {profile.avatar ? <img src={profile.avatar} className="w-full h-full object-cover" /> : <div className="w-full h-full flex items-center justify-center opacity-50">{currentNicheData.icon}</div>}
                        </div>
                        <div className="leading-tight drop-shadow-sm">
                            <div className="text-xs font-bold uppercase tracking-wider">{profile.name}</div>
                            <div className="text-[10px] opacity-80">{profile.handle}</div>
                        </div>
                    </div>
                );
            };

            const ProgressBar = ({ current, total, color }) => (
                <div className="flex gap-1 w-full max-w-[80px]">
                    {Array.from({length: total}).map((_, i) => (
                        <div key={i} className={`h-1 rounded-full flex-1 transition-all ${i <= current ? 'opacity-100' : 'opacity-20'}`} style={{ backgroundColor: color }}></div>
                    ))}
                </div>
            );

            // --- RENDERIZADORES ---
            
            const renderClassic = (slide, fmt, fonts, isCover, index) => (
                <div className="flex flex-col h-full relative z-10">
                    <div className="absolute top-0 left-0 w-full p-8 z-20"><ProfileBadge mode="dark" /></div>
                    <div className="p-12 md:p-14 flex-1 flex flex-col justify-center h-full overflow-hidden mt-8">
                        {slide.imageKeyword && (
                            <div className="mb-8 relative rounded-sm overflow-hidden shadow-lg flex-shrink-0 border border-current/10 group" style={{ height: isCover ? '35%' : '25%' }}>
                                <img src={`https://image.pollinations.ai/prompt/${slide.imageKeyword}%20${currentNicheData.imageStyles[activeImageStyle].prompt}?width=800&height=600&nologo=true`} className="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105" crossOrigin="anonymous" />
                            </div>
                        )}
                        <div className="flex flex-col flex-1 min-h-0 justify-start">
                            <h1 style={{ fontFamily: fonts.title, color: theme.secondary === '#ffffff' && activeNiche === 'agro' ? theme.text : theme.secondary, fontSize: getResponsiveFontSize(slide.title, 'title', fmt.width, fontScales.title), lineHeight: 1.1 }} className="font-bold mb-4 break-words hyphens-auto uppercase tracking-tight">
                                {slide.title}
                            </h1>
                            {slide.subtitle && <h3 className="mb-4 font-medium opacity-80 uppercase tracking-widest text-xs" style={{ color: theme.primary, fontSize: getResponsiveFontSize(slide.subtitle, 'subtitle', fmt.width, fontScales.subtitle) }}>{slide.subtitle}</h3>}
                            <p className="opacity-80 leading-relaxed overflow-hidden text-ellipsis font-light" style={{ fontSize: getResponsiveFontSize(slide.content, 'body', fmt.width, fontScales.body) }}>{slide.content}</p>
                        </div>
                    </div>
                    <div className="absolute bottom-0 w-full p-8 flex justify-between items-center">
                         <div className="text-xs font-bold opacity-40">{index + 1} / {slides.length}</div>
                         <ProgressBar current={index} total={slides.length} color={theme.primary} />
                    </div>
                </div>
            );

            const renderImmersive = (slide, fmt, fonts, isCover, index) => (
                <div className="h-full w-full relative flex flex-col justify-end p-14 z-10">
                    {slide.imageKeyword && (
                        <div className="absolute inset-0 z-0">
                            <img src={`https://image.pollinations.ai/prompt/${slide.imageKeyword}%20${currentNicheData.imageStyles[activeImageStyle].prompt}?width=1080&height=1350&nologo=true`} className="w-full h-full object-cover" crossOrigin="anonymous" />
                            <div className="absolute inset-0 bg-gradient-to-t from-black/90 via-black/60 to-black/10"></div>
                        </div>
                    )}
                    <div className="absolute top-0 left-0 w-full p-8 z-20"><ProfileBadge mode="light" /></div>
                    <div className="relative z-10 text-white flex flex-col justify-end max-h-[80%] pb-8">
                        <div className="w-16 h-1 mb-8 flex-shrink-0" style={{ background: theme.primary }}></div>
                        <h1 style={{ fontFamily: fonts.title, fontSize: getResponsiveFontSize(slide.title, 'title', fmt.width, fontScales.title), lineHeight: 1 }} className="font-bold drop-shadow-lg mb-6 break-words uppercase">{slide.title}</h1>
                        <p className="opacity-90 font-light leading-relaxed border-l-4 pl-6 overflow-hidden text-ellipsis" style={{ borderColor: theme.primary, fontSize: getResponsiveFontSize(slide.content, 'body', fmt.width, fontScales.body) }}>{slide.content}</p>
                    </div>
                     {!isCover && slide.type !== 'cta' && (
                         <div className="absolute bottom-6 right-6 flex items-center gap-2 text-white/50 text-[10px] uppercase font-bold tracking-widest animate-pulse">
                            Arrastar <ArrowRight size={12} />
                         </div>
                    )}
                </div>
            );

            const renderListicle = (slide, index, fmt, fonts, isCover) => (
                <div className="h-full w-full flex flex-col p-14 relative z-10 overflow-hidden" style={{ background: theme.background }}>
                    <div className="absolute top-8 right-8 z-20"><ProfileBadge mode="dark"/></div>
                    <div className="absolute -top-10 -left-10 opacity-[0.08] font-black select-none pointer-events-none" style={{ fontSize: getResponsiveFontSize('00', 'number', fmt.width), fontFamily: fonts.title, color: theme.secondary === '#ffffff' && activeNiche === 'agro' ? theme.text : theme.secondary }}>
                        {String(index + 1).padStart(2, '0')}
                    </div>
                    <div className="flex flex-col justify-center flex-1 z-10 h-full mt-10">
                        <div className="w-12 h-12 rounded-sm mb-8 flex items-center justify-center font-bold text-white shadow-lg" style={{ background: theme.primary }}>{index + 1}</div>
                        <h1 style={{ fontFamily: fonts.title, color: theme.secondary === '#ffffff' && activeNiche === 'agro' ? theme.text : theme.secondary, fontSize: getResponsiveFontSize(slide.title, 'title', fmt.width, fontScales.title), lineHeight: 1.1 }} className="font-bold mb-6 uppercase">{slide.title}</h1>
                        {slide.imageKeyword && (
                            <div className="w-full h-40 rounded-sm overflow-hidden mb-6 shadow-md object-cover flex-shrink-0 border border-current/10">
                                <img src={`https://image.pollinations.ai/prompt/${slide.imageKeyword}%20${currentNicheData.imageStyles[activeImageStyle].prompt}?width=800&height=400&nologo=true`} className="w-full h-full object-cover" crossOrigin="anonymous"/>
                            </div>
                        )}
                        <p className="leading-relaxed opacity-80 font-light" style={{ fontSize: getResponsiveFontSize(slide.content, 'body', fmt.width, fontScales.body) }}>{slide.content}</p>
                    </div>
                </div>
            );

            const renderMinimal = (slide, fmt, fonts, isCover, index) => (
                <div className="h-full w-full flex flex-col p-14 relative z-10 justify-between" style={{ background: theme.background }}>
                     <div className="absolute top-8 left-8"><ProfileBadge mode="dark"/></div>
                     <div className="flex flex-col justify-center flex-1 min-h-0 mt-10">
                        <div className="mb-8 opacity-40" style={{ color: theme.primary }}>
                            {activeNiche === 'agro' ? <Tractor size={64} strokeWidth={1} /> : <Scissors size={64} strokeWidth={1} />}
                        </div>
                        <h1 style={{ fontFamily: fonts.title, color: theme.secondary === '#ffffff' && activeNiche === 'agro' ? theme.text : theme.secondary, fontSize: getResponsiveFontSize(slide.title, 'title', fmt.width, fontScales.title), lineHeight: 0.95 }} className="font-black tracking-tighter mb-8 break-words uppercase">{slide.title}</h1>
                        <p className="font-light leading-relaxed max-w-xl overflow-hidden border-l-2 pl-4" style={{ borderColor: theme.accent, color: theme.text, fontSize: getResponsiveFontSize(slide.content, 'body', fmt.width, fontScales.body) }}>{slide.content}</p>
                     </div>
                     <div className="w-full flex justify-between items-end border-t border-current/10 pt-6">
                        <span className="text-4xl font-black opacity-10" style={{ fontFamily: fonts.title, color: theme.secondary }}>{String(index+1).padStart(2,'0')}</span>
                     </div>
                </div>
            );

            const renderSlide = (slide, index, scale = 1, isPreview = false) => {
                const fmt = FORMATS[activeFormat];
                const fonts = FONT_PAIRS[activeFontPair];
                const isCover = slide.type === 'cover';
                
                let content;
                switch (activeLayout) {
                    case 'immersive': content = renderImmersive(slide, fmt, fonts, isCover, index); break;
                    case 'minimal': content = renderMinimal(slide, fmt, fonts, isCover, index); break;
                    case 'quote': content = renderMinimal(slide, fmt, fonts, isCover, index); break; // Reuso inteligente
                    case 'listicle': content = renderListicle(slide, index, fmt, fonts, isCover); break;
                    default: content = renderClassic(slide, fmt, fonts, isCover, index); break;
                }

                return (
                    <div 
                        id={!isPreview ? "slide-preview-area" : undefined}
                        className="relative overflow-hidden shadow-sm flex flex-col"
                        style={{ width: `${fmt.width * scale}px`, height: `${fmt.height * scale}px`, backgroundColor: theme.background, color: theme.text, fontFamily: fonts.body }}
                    >
                        {content}
                    </div>
                );
            };

            return (
                <div className="h-screen flex flex-col bg-stone-900 text-stone-100 overflow-hidden font-sans">
                    {/* --- HEADER --- */}
                    <header className="bg-stone-950 border-b border-stone-800 px-4 py-3 flex justify-between items-center shrink-0 z-50">
                        <div className="flex items-center gap-3">
                            <div className={`w-8 h-8 ${currentNicheData.bgColor} rounded-sm flex items-center justify-center text-white shadow-md transition-colors duration-500`}>
                                {currentNicheData.icon}
                            </div>
                            <div><h1 className="font-bold text-lg text-white tracking-tight">{activeNiche === 'barber' ? 'Barber' : 'Agro'}<span className={currentNicheData.color}>Pro</span></h1></div>
                        </div>
                        <div className="flex items-center gap-3">
                            <button onClick={() => handleExport('pdf')} disabled={isExporting} className={`flex items-center gap-2 px-4 py-2 ${currentNicheData.bgColor} text-white rounded-sm text-sm font-bold hover:opacity-90 transition-all shadow-md disabled:opacity-70`}>
                                {isExporting ? <RefreshCw className="animate-spin" size={16}/> : <FileText size={16}/>}
                                <span>Salvar PDF</span>
                            </button>
                        </div>
                    </header>

                    <div className="flex-1 flex overflow-hidden">
                        {/* --- SIDEBAR --- */}
                        <aside className="w-80 bg-stone-950 border-r border-stone-800 overflow-y-auto flex flex-col z-20 shadow-lg">
                            
                            {/* NICHE SELECTOR (TOP) */}
                            <div className="p-4 border-b border-stone-800">
                                <label className="text-[10px] uppercase font-bold text-stone-500 mb-2 block tracking-widest">Nicho de Mercado</label>
                                <div className="flex gap-2 bg-stone-900 p-1 rounded border border-stone-800">
                                    {Object.values(NICHES).map(niche => (
                                        <button 
                                            key={niche.id}
                                            onClick={() => handleNicheChange(niche.id)}
                                            className={`flex-1 flex items-center justify-center gap-2 py-2 rounded text-xs font-bold transition-all ${activeNiche === niche.id ? `${niche.bgColor} text-white shadow` : 'text-stone-500 hover:bg-stone-800'}`}
                                        >
                                            {niche.icon}
                                            {niche.id === 'barber' ? 'Barber' : 'Agro'}
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="flex border-b border-stone-800">
                                {['design', 'profile', 'content'].map(tab => (
                                    <button key={tab} onClick={() => setActiveTab(tab)} className={`flex-1 py-3 text-xs font-bold uppercase tracking-wider ${activeTab === tab ? `${currentNicheData.color} border-b-2 ${currentNicheData.borderColor}` : 'text-stone-500 hover:text-stone-300'}`}>{tab === 'design' ? 'Estilo' : tab === 'profile' ? 'Perfil' : 'Conteúdo'}</button>
                                ))}
                            </div>

                            <div className="p-5 space-y-8 pb-20">
                                {activeTab === 'design' && (
                                    <>
                                        <div className="space-y-3">
                                            <h3 className="text-xs font-bold text-stone-500 uppercase tracking-wider flex items-center gap-2"><Layout size={14} /> Layout</h3>
                                            <div className="grid grid-cols-2 gap-2">
                                                {Object.values(LAYOUT_STYLES).map((layout) => (
                                                    <button key={layout.id} onClick={() => setActiveLayout(layout.id)} className={`p-2 border rounded-sm text-left transition-all ${activeLayout === layout.id ? `${currentNicheData.borderColor} ${activeNiche === 'agro' ? 'bg-emerald-900/20' : 'bg-amber-900/20'} ring-1` : 'border-stone-800 hover:bg-stone-900'}`}>
                                                        <div className="text-xs font-bold text-stone-200">{layout.name}</div>
                                                    </button>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="space-y-3">
                                            <h3 className="text-xs font-bold text-stone-500 uppercase tracking-wider flex items-center gap-2"><ImageIcon size={14} /> Estilo de Imagem</h3>
                                            <select value={activeImageStyle} onChange={(e) => setActiveImageStyle(e.target.value)} className="w-full p-2 text-sm bg-stone-900 border border-stone-800 rounded-sm text-stone-200 focus:border-current outline-none">
                                                {Object.entries(currentNicheData.imageStyles).map(([k, v]) => <option key={k} value={k}>{v.name}</option>)}
                                            </select>
                                        </div>
                                        <div className="space-y-3">
                                            <h3 className="text-xs font-bold text-stone-500 uppercase tracking-wider flex items-center gap-2"><Palette size={14} /> Cores</h3>
                                            <div className="grid grid-cols-5 gap-2">
                                                {Object.entries(theme).map(([key, val]) => (
                                                    <div key={key} className="relative w-8 h-8 rounded-full border border-stone-700 overflow-hidden cursor-pointer group">
                                                        <input type="color" value={val} onChange={(e) => setTheme({...theme, [key]: e.target.value})} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"/>
                                                        <div className="w-full h-full" style={{ background: val }}></div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </>
                                )}

                                {activeTab === 'profile' && (
                                    <div className="space-y-6">
                                        <div className="text-center">
                                            <div className="w-24 h-24 mx-auto bg-stone-900 rounded-full mb-3 relative group overflow-hidden border-2 border-dashed border-stone-700 flex items-center justify-center">
                                                {profile.avatar ? <img src={profile.avatar} className="w-full h-full object-cover" /> : <div className="text-stone-600">{currentNicheData.icon}</div>}
                                                <input type="file" accept="image/*" onChange={handleAvatarUpload} className="absolute inset-0 opacity-0 cursor-pointer" />
                                                <div className="absolute inset-0 bg-black/50 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs font-bold">Alterar</div>
                                            </div>
                                            <p className="text-xs text-stone-500">Logo da Marca</p>
                                        </div>
                                        <div className="space-y-3">
                                            <div><label className="text-xs font-bold text-stone-500">Nome</label><input value={profile.name} onChange={(e) => setProfile({...profile, name: e.target.value})} className="w-full p-2 bg-stone-900 border border-stone-800 rounded-sm text-sm text-white outline-none focus:border-stone-600" /></div>
                                            <div><label className="text-xs font-bold text-stone-500">Handle / Bio</label><input value={profile.handle} onChange={(e) => setProfile({...profile, handle: e.target.value})} className="w-full p-2 bg-stone-900 border border-stone-800 rounded-sm text-sm text-white outline-none focus:border-stone-600" /></div>
                                            <div className="flex items-center gap-2"><input type="checkbox" checked={profile.show} onChange={(e) => setProfile({...profile, show: e.target.checked})} /><label className="text-sm text-stone-300">Mostrar</label></div>
                                        </div>
                                    </div>
                                )}

                                {activeTab === 'content' && (
                                    <div className="space-y-6">
                                        <div className="p-4 bg-stone-900 rounded-xl border border-stone-800">
                                            <label className={`text-xs font-bold ${currentNicheData.color} mb-2 block flex items-center gap-2`}><Sparkles size={12}/> IA GERADORA ({activeNiche.toUpperCase()})</label>
                                            <div className="relative">
                                                <input value={topic} onChange={(e) => setTopic(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && generateCarousel()} placeholder={activeNiche === 'agro' ? "Ex: Plantio de Soja..." : "Ex: Corte Degradê..."} className="w-full pl-3 pr-10 py-2 bg-stone-950 border border-stone-700 rounded-sm text-sm focus:border-current text-white outline-none" />
                                                <button onClick={generateCarousel} disabled={isGenerating} className={`absolute right-1.5 top-1.5 p-1 ${currentNicheData.bgColor} text-white rounded-sm hover:opacity-90 disabled:opacity-50`}>{isGenerating ? <RefreshCw className="animate-spin" size={14}/> : <ChevronRight size={14}/>}</button>
                                            </div>
                                        </div>
                                        <div className="space-y-4 pt-4 border-t border-stone-800">
                                            <div className="flex justify-between items-center">
                                                <h3 className="text-xs font-bold text-stone-500 uppercase tracking-wider">Slide {activeSlideIndex + 1}</h3>
                                                <button onClick={() => removeSlide(activeSlideIndex)} className="text-red-500 hover:text-red-400 p-1" title="Excluir Slide"><Trash2 size={14}/></button>
                                            </div>
                                            <input value={slides[activeSlideIndex].title} onChange={(e) => { const n = [...slides]; n[activeSlideIndex].title = e.target.value; setSlides(n); }} className="w-full p-2 bg-stone-900 border border-stone-800 rounded-sm text-sm font-bold text-white outline-none" placeholder="Título" />
                                            <textarea value={slides[activeSlideIndex].content} onChange={(e) => { const n = [...slides]; n[activeSlideIndex].content = e.target.value; setSlides(n); }} rows={4} className="w-full p-2 bg-stone-900 border border-stone-800 rounded-sm text-sm text-stone-300 outline-none" placeholder="Texto" />
                                            <div className="flex items-center gap-2">
                                                <ImageIcon size={14} className="text-stone-500"/>
                                                <input value={slides[activeSlideIndex].imageKeyword || ''} onChange={(e) => { const n = [...slides]; n[activeSlideIndex].imageKeyword = e.target.value; setSlides(n); }} className="flex-1 bg-transparent border-b border-stone-800 text-xs py-1 outline-none text-stone-400" placeholder="Palavra-chave imagem..." />
                                            </div>
                                            <button onClick={addSlide} className="w-full py-2 bg-stone-800 hover:bg-stone-700 rounded-sm text-xs font-bold text-stone-300 flex items-center justify-center gap-2 mt-4 border border-stone-700"><Plus size={14}/> Adicionar Slide</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </aside>

                        {/* --- MAIN CANVAS --- */}
                        <main className="flex-1 bg-stone-900 overflow-hidden relative flex flex-col items-center justify-center p-8 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-stone-800 to-stone-950">
                            {/* Toggle View */}
                            <div className="absolute top-4 flex gap-2 bg-stone-950/80 backdrop-blur p-1 rounded-full shadow border border-stone-800 z-30">
                                <button onClick={() => setViewMode('edit')} className={`p-2 rounded-full ${viewMode === 'edit' ? `${currentNicheData.bgColor} text-white` : 'text-stone-500 hover:bg-stone-800'}`}><Monitor size={14}/></button>
                                <button onClick={() => setViewMode('grid')} className={`p-2 rounded-full ${viewMode === 'grid' ? `${currentNicheData.bgColor} text-white` : 'text-stone-500 hover:bg-stone-800'}`}><Grid size={14}/></button>
                            </div>

                            {viewMode === 'edit' ? (
                                <div className="flex items-center gap-4 md:gap-10 w-full justify-center h-full relative">
                                    {/* Botão ANTERIOR */}
                                    <button 
                                        onClick={() => setActiveSlideIndex(i => Math.max(0, i-1))} 
                                        disabled={activeSlideIndex===0} 
                                        className={`p-5 bg-stone-950/90 border border-stone-800 rounded-full shadow-2xl hover:${currentNicheData.borderColor} hover:text-${activeNiche === 'agro' ? 'emerald' : 'amber'}-500 transition-all text-white disabled:opacity-30 disabled:cursor-not-allowed group z-40 transform hover:scale-110`}
                                        title="Slide Anterior"
                                    >
                                        <ChevronLeft size={32} className="group-hover:-translate-x-1 transition-transform" />
                                    </button>
                                    
                                    <div className="transform transition-all duration-500 shadow-2xl shadow-black rounded-sm ring-1 ring-white/10" style={{ transform: `scale(${Math.min(1, (window.innerHeight - 150) / FORMATS[activeFormat].height)})` }}>
                                        {renderSlide(slides[activeSlideIndex], activeSlideIndex)}
                                    </div>
                                    
                                    {/* Botão PRÓXIMO */}
                                    <button 
                                        onClick={() => setActiveSlideIndex(i => Math.min(slides.length-1, i+1))} 
                                        disabled={activeSlideIndex===slides.length-1} 
                                        className={`p-5 bg-stone-950/90 border border-stone-800 rounded-full shadow-2xl hover:${currentNicheData.borderColor} hover:text-${activeNiche === 'agro' ? 'emerald' : 'amber'}-500 transition-all text-white disabled:opacity-30 disabled:cursor-not-allowed group z-40 transform hover:scale-110`}
                                        title="Próximo Slide"
                                    >
                                        <ChevronRight size={32} className="group-hover:translate-x-1 transition-transform" />
                                    </button>
                                </div>
                            ) : (
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-6xl h-full overflow-y-auto content-start pt-10 px-4">
                                    {slides.map((s, i) => (
                                        <div key={s.id} draggable onDragStart={(e)=>handleDrag(e,i,'start')} onDragOver={(e)=>handleDrag(e,i,'over')} onDragEnd={(e)=>handleDrag(e,i,'end')} onClick={()=>{setActiveSlideIndex(i);setViewMode('edit')}} className={`cursor-pointer transition-all ${dragedIndex===i?'opacity-30 scale-90':''} hover:-translate-y-1`}>
                                            <div className="border border-stone-800 rounded-sm overflow-hidden shadow-sm bg-stone-950 relative aspect-[4/5]">
                                                <div className="absolute inset-0 transform scale-[0.25] origin-top-left w-[400%] h-[400%] pointer-events-none">{renderSlide(s, i, 1, true)}</div>
                                            </div>
                                            <div className="text-center text-xs mt-2 font-bold text-stone-500">Slide {i+1}</div>
                                        </div>
                                    ))}
                                    <button onClick={addSlide} className={`border-2 border-dashed border-stone-800 rounded-sm aspect-[4/5] flex flex-col items-center justify-center text-stone-600 hover:${currentNicheData.color} hover:border-current hover:bg-stone-900 transition-all`}>
                                        <Plus size={32} />
                                        <span className="text-xs font-bold mt-2 uppercase">Novo Slide</span>
                                    </button>
                                </div>
                            )}
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>